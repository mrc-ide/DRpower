<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CIs and Overdispersion • DRpower</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="CIs and Overdispersion">
<meta property="og:description" content="DRpower">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DRpower</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    How it works
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rationale1_background.html">Background</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Analysing data</li>
    <li>
      <a href="../articles/rationale2_issue.html">CIs and overdispersion</a>
    </li>
    <li>
      <a href="../articles/rationale3_design_effect.html">The design effect</a>
    </li>
    <li>
      <a href="../articles/rationale4_weaknesses.html">Weaknesses with the traditional approach</a>
    </li>
    <li>
      <a href="../articles/rationale5_bayesian.html">A Bayesian approach</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Designing a study</li>
    <li>
      <a href="../articles/rationale6_master_protocol.html">Sample size calculation in the 2020 master protocol</a>
    </li>
    <li>
      <a href="../articles/rationale7_ztest.html">The one-sample z-test</a>
    </li>
    <li>
      <a href="../articles/rationale8_power.html">Power and sample size in the DRpower model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial_design.html">Designing a study</a>
    </li>
    <li>
      <a href="../articles/tutorial_analysis.html">Analysing data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mathematical_details.html">Mathematical details</a>
    </li>
    <li>
      <a href="../articles/historical_analysis.html">Historical analysis</a>
    </li>
    <li>
      <a href="../articles/summarise_prevalence.html">How to summarise the prevalence</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/DRpower/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="rationale2_issue_files/kePrint-0.0.1/kePrint.js"></script><link href="rationale2_issue_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>CIs and Overdispersion</h1>
                        <h4 data-toc-skip class="author">Bob Verity</h4>
            
            <h4 data-toc-skip class="date">Last updated: 30 Nov
2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/DRpower/blob/HEAD/vignettes/rationale2_issue.Rmd" class="external-link"><code>vignettes/rationale2_issue.Rmd</code></a></small>
      <div class="hidden name"><code>rationale2_issue.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="why-is-this-a-tricky-problem">2. Why is this a tricky problem?<a class="anchor" aria-label="anchor" href="#why-is-this-a-tricky-problem"></a>
</h2>
<p>The type of data that we will work with is shown below. This is a
very simple dataset consisting of a numerator and denominator for each
site. The site-level prevalence is calculated as numerator over
denominator, expressed as a percentage.</p>
<table class="table table table-striped table-hover table-condensed" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;border-bottom: 1px solid; border-top: 1px solid">
site
</th>
<th style="text-align:right;border-bottom: 1px solid; border-top: 1px solid">
n_tested
</th>
<th style="text-align:right;border-bottom: 1px solid; border-top: 1px solid">
n_deletions
</th>
<th style="text-align:right;border-bottom: 1px solid; border-top: 1px solid">
site_prevalence
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
15
</td>
<td style="text-align:right;">
30
</td>
</tr>
<tr>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
50
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:right;border-bottom: 1px solid">
5
</td>
<td style="text-align:right;border-bottom: 1px solid">
50
</td>
<td style="text-align:right;border-bottom: 1px solid">
7
</td>
<td style="text-align:right;border-bottom: 1px solid">
14
</td>
</tr>
</tbody>
</table>
<p>This example is even simpler than most real world datasets, as here
the number of people tested is identical over all sites when in reality
it often varies. So why is this a tricky dataset to analyse? How can we
possibly get our analysis wrong here!?</p>
<p>Recall that our aim is to estimate prevalence of deletions at the
domain level, meaning we will need to pool results over sites. One way
to do this is to sum the number of deletions over sites, then sum the
number tested over sites, then divide one by the other to get the
prevalence. This gives 35 / 250 = 14%. This analysis assumes that all
individuals are independent, i.e., they have the same probability of
carrying the <em>pfhrp2/3</em> deleted strain irrespective of what site
they belong to.</p>
<p>We also typically want to construct a confidence interval (CI) on
this result. A common approach for binomial data like this would be to
use the <a href="https://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Normal_approximation_interval_or_Wald_interval" class="external-link">Wald
interval</a>, defined as <span class="math inline">\(\hat{p} \pm
z\sqrt{\frac{\hat{p}(1 - \hat{p})}{nc}}\)</span>, where <span class="math inline">\(\hat{p}\)</span> is our estimate of the
prevalence, <span class="math inline">\(n\)</span> is the sample size
per site, <span class="math inline">\(c\)</span> is the number of sites
and <span class="math inline">\(z\)</span> is the critical value of the
normal distribution (for a 95% CI we can use <span class="math inline">\(z = 1.96\)</span>). For the data above we get 14%
<span class="math inline">\(\pm\)</span> 4.3%, which gives the interval
(9.7% to 18.3%). Based on this interval we would confidently conclude
that the prevalence of deletions is above 5% at the domain level.</p>
<div class="section level3">
<h3 id="dealing-with-overdispersion">2.1 Dealing with overdispersion<a class="anchor" aria-label="anchor" href="#dealing-with-overdispersion"></a>
</h3>
<p>But now look at the data again, this time focusing on the prevalence
in each site. Notice that some sites are quite a bit higher than this
14% average level, while some are much lower. Could this be explained by
random chance? We can explore this statistically by looking at the
spread between sites. If individuals are completely independent then we
would expect the variance in site-level prevalence to be approximately
<span class="math inline">\(\frac{\hat{p}(1 - \hat{p})}{n}\)</span>.
Hence, we would expect values to fall within the shaded region in the
plot below around 95% of the time:</p>
<p><img src="rationale2_issue_files/figure-html/unnamed-chunk-4-1.png" width="480"></p>
<p>We can see that only 2 out of 5 sites fall inside this region, which
is very unlikely by chance. Sites are therefore
<strong>overdispersed</strong>, meaning there is a greater spread in
values than we would expect by chance. Another way of looking at this is
to say that individuals <em>within</em> a site are more similar to each
other than we would expect by chance, i.e., there is
<strong>intra-cluster correlation</strong> (ICC). These sound like two
very different ideas, but in fact they are two sides of the same coin -
if there is overdispersion between sites (clusters) then there must be
ICC within sites, and if there is ICC then there must be
overdispersion.</p>
<p>There are a range of factors that can cause intra-cluster
correlation. Individuals in the same site may have similar behaviours,
similar economic levels and access to care, similar risk factors or even
similar phenotypes. The site itself (i.e., health facility) may also
introduce correlations, for example the same hospital practices may
affect the entire community. Finally, the actual process of disease
transmission can introduce correlations, for example if there has been a
local outbreak then we are more likely to see a second <em>pfhrp2/3</em>
deleted sample having seen a first.</p>
<p>If our data our overdispersed then there will be more uncertainty
around our domain-level estimate than we originally expected. This means
the CIs above will be too narrow and we risk of incorrectly concluding
that prevalence is above 5%. One simple way to deal with this issue is
to treat our 5 sites as 5 observations rather than 250 observations,
ignoring the fact that we know the sample size per site. In this case,
we would calculate the domain-level prevalence as the mean of the 5
site-level values. This calculation gives <span class="math inline">\(\hat{p} =\)</span> 14%, exactly the same as
before. The reason for getting the same value here is that sample sizes
are the same over all sites, although in general the two methods may
give different results.</p>
<p>But how should we construct a CI in this case? We are no longer
treating our observations as binomial counts, meaning we should not use
the Wald interval. First, we calculate the sample variance, <span class="math inline">\(s^2 = \frac{\sum_{i=1}^c (\hat{p}_i -
\hat{p})^2}{c - 1}\)</span>, where <span class="math inline">\(\hat{p}_i\)</span> is the observed prevalence in
site <span class="math inline">\(i\)</span>. Then we calculate the CI as
<span class="math inline">\(\hat{p} \pm z\sqrt{\frac{s^2}{c}}\)</span>
(to be even more exact we could take <span class="math inline">\(z\)</span> from the Student’s t-distribution
rather than the normal distribution). For our example data this gives
14% <span class="math inline">\(\pm\)</span> 10.15%, which gives the
interval (3.85% to 24.15%). This is a <em>much</em> wider CI than
before, and this time it even spans 5% meaning we would not switch RDTs
based on this result. We can see how the simple choice of how to
construct CIs has a major effect on the study conclusions, and in this
case would result in a different nationwide strategy with respect to
switching RDTs. Hence, it is very important that we get this right!</p>
<p>This second way of constructing CIs is better than the first in that
it takes into account overdispersion, but even this approach suffers
from some weaknesses. Before getting into these issues we should talk
about the design effect.</p>
<p align="center">
<button class="btn btn-primary" onclick="window.location.href='https://mrc-ide.github.io/DRpower/articles/rationale3_design_effect.html';">
Next topic
</button>
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bob Verity, Shazia Ruybal.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
