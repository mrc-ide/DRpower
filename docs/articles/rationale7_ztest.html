<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The One-sample Z-test • DRpower</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The One-sample Z-test">
<meta property="og:description" content="DRpower">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DRpower</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    How it works
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rationale1_background.html">Background</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Analysing data</li>
    <li>
      <a href="../articles/rationale2_issue.html">CIs and overdispersion</a>
    </li>
    <li>
      <a href="../articles/rationale3_design_effect.html">The design effect</a>
    </li>
    <li>
      <a href="../articles/rationale4_weaknesses.html">Weaknesses with the traditional approach</a>
    </li>
    <li>
      <a href="../articles/rationale5_bayesian.html">A Bayesian approach</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Designing a study</li>
    <li>
      <a href="../articles/rationale6_master_protocol.html">Sample size calculation in the 2020 master protocol</a>
    </li>
    <li>
      <a href="../articles/rationale7_ztest.html">The one-sample z-test</a>
    </li>
    <li>
      <a href="../articles/rationale8_power.html">Power and sample size in the DRpower model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial_design.html">Designing a study</a>
    </li>
    <li>
      <a href="../articles/tutorial_analysis.html">Analysing data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mathematical_details.html">Mathematical details</a>
    </li>
    <li>
      <a href="../articles/historical_analysis.html">Historical analysis</a>
    </li>
    <li>
      <a href="../articles/summarise_prevalence.html">How to summarise the prevalence</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/DRpower/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>The One-sample Z-test</h1>
                        <h4 data-toc-skip class="author">Bob Verity</h4>
            
            <h4 data-toc-skip class="date">Last updated: 09 Dec
2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/DRpower/blob/HEAD/vignettes/rationale7_ztest.Rmd" class="external-link"><code>vignettes/rationale7_ztest.Rmd</code></a></small>
      <div class="hidden name"><code>rationale7_ztest.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="power-and-sample-size-under-the-z-test">7. Power and sample size under the z-test<a class="anchor" aria-label="anchor" href="#power-and-sample-size-under-the-z-test"></a>
</h2>
<p>In the previous section, we found that using an approach that mixed
CI estimation with hypothesis testing resulted in low power. Here, we
start from scratch with a purely hypothesis testing approach. Our null
hypothesis will be that the prevalence of deletions is equal to a known
value (the threshold), and we are going to try to disprove this
hypothesis.</p>
<p>The standard test here is the one-sample z-test, also called the
one-sample proportion test. We start by calculating the <span class="math inline">\(Z\)</span> test statistic as follows:</p>
<p><span class="math inline">\(Z = \frac{\displaystyle |\hat{p} -
\mu|}{\displaystyle
\sqrt{\frac{\hat{p}(1-\hat{p})}{N}D_{eff}}}\)</span></p>
<p>This statistic follows the z-distribution (i.e. the normal
distribution) under the null hypothesis. We can control how often we
come to a false-positive conclusion by setting a significance level
<span class="math inline">\(\alpha\)</span>. We will reject the null
hypothesis whenever our <span class="math inline">\(Z\)</span> statistic
is greater in magnitude (either positive or negative) than the critical
value <span class="math inline">\(z_{\tiny 1 - \alpha/2}\)</span>.</p>
<p>We can calculate power under the z-test as the probability of being
more extreme than this critical value. This is given by the following
formula:</p>
<p><span class="math inline">\(\text{Power} = \Phi\Bigg( \frac{|p -
\mu|}{\sqrt{\frac{p(1-p)}{N}D_{eff} }} - z_{\tiny 1 - \alpha/2}
\Bigg)\)</span></p>
<p>where <span class="math inline">\(\Phi()\)</span> is the cumulative
density function of the normal distribution. What would happen if we
used the value of <span class="math inline">\(N\)</span> taken from the
mistaken approach described in the 2020 Master Protocol? We can explore
this very neatly by substituting the value <span class="math inline">\(N
= z_{\tiny 1 - \alpha/2}^2 \frac{\displaystyle p(1-p)}{\displaystyle
(p-\mu)^2}D_{eff}\)</span> from the Master Protocol into the formula
above. Interestingly, we find that <strong>every term inside the
brackets cancels out</strong>! We are left with <span class="math inline">\(\text{Power} = \Phi(0)\)</span>, which is equal to
0.5. This is essentially a mathematical proof of what we described in
the previous section - that power is forced to equal 50% when using the
formula from the Master Protocol.</p>
<p>Hopefully by this point I have convinced you of the issues with the
CI-based approach. So, what should be the correct sample size formula?
We can find this by rearranging the power formula above to give us the
exact <span class="math inline">\(N\)</span> needed to achieve any given
power. We will use the symbol <span class="math inline">\(\beta\)</span>
to represent the false-negative rate, meaning <span class="math inline">\(\text{Power} = 1 - \beta\)</span>. We will also
define <span class="math inline">\(z_{\tiny 1 - \beta}\)</span> to be
the critical value of the normal distribution at the value <span class="math inline">\(1 - \beta\)</span>. This results in the following
formula:</p>
<p><span class="math inline">\(N \geq (z_{\tiny 1 - \beta} + z_{\tiny 1
- \alpha/2})^2 \frac{\displaystyle p(1-p)}{\displaystyle
(p-\mu)^2}D_{eff}\)</span></p>
<p>It is interesting to see how similar this is to the formula in the
Master Protocol - the only difference is the addition of the extra <span class="math inline">\(z_{\tiny 1 - \beta}\)</span> term. This extra term
means that we will always be underestimating sample sizes if we use the
Master Protocol formula.</p>
<p>But just how wrong was the original formula? Dividing one by the
other, we find that z-test sample sizes are greater than Master Protocol
sample sizes by a factor <span class="math inline">\((1 + z_{\tiny 1 -
\beta}/z_{\tiny 1 - \alpha/2})^2\)</span>. If we are aiming for a power
of 80% then this factor equals 2.043. So, the actual sample size
required is almost exactly double what we would get from the Master
Protocol formula.</p>
<p>To put this in context, if previously we found that 551 samples are
needed, then with this new (corrected) formula we find that 1126 samples
are needed. This is obviously significantly higher even than the updated
recommendation of 600, and is likely to be beyond what many malaria
control programmes can achieve within their logistic and financial
constraints. To overcome this, we need to turn to more powerful
statistical approaches.</p>
<p align="center">
<button class="btn btn-primary" onclick="window.location.href='https://mrc-ide.github.io/DRpower/articles/rationale8_power.html';">
Next topic
</button>
</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bob Verity, Shazia Ruybal.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
