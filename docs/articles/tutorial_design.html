<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Designing a study • DRpower</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Designing a study">
<meta property="og:description" content="DRpower">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DRpower</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    How it works
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rationale1_background.html">Background</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Analysing data</li>
    <li>
      <a href="../articles/rationale2_issue.html">CIs and overdispersion</a>
    </li>
    <li>
      <a href="../articles/rationale3_design_effect.html">The design effect</a>
    </li>
    <li>
      <a href="../articles/rationale4_weaknesses.html">Weaknesses with the traditional approach</a>
    </li>
    <li>
      <a href="../articles/rationale5_bayesian.html">A Bayesian approach</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Designing a study</li>
    <li>
      <a href="../articles/rationale6_master_protocol.html">Sample size calculation in the 2020 master protocol</a>
    </li>
    <li>
      <a href="../articles/rationale7_ztest.html">The one-sample z-test</a>
    </li>
    <li>
      <a href="../articles/rationale8_power.html">Power and sample size in the DRpower model</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial_design.html">Designing a study</a>
    </li>
    <li>
      <a href="../articles/tutorial_analysis.html">Analysing data</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mathematical_details.html">Mathematical details</a>
    </li>
    <li>
      <a href="../articles/historical_analysis.html">Historical analysis</a>
    </li>
    <li>
      <a href="../articles/summarise_prevalence.html">How to summarise the prevalence</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/DRpower/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Designing a study</h1>
                        <h4 data-toc-skip class="author">Bob Verity</h4>
            
            <h4 data-toc-skip class="date">Last updated: 25 Jul
2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/DRpower/blob/HEAD/vignettes/tutorial_design.Rmd" class="external-link"><code>vignettes/tutorial_design.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial_design.Rmd</code></div>

    </div>

    
    
<p>This tutorial demonstrates how you can use the DRpower package in the
design phase of a <em>pfhrp2/3</em> deletion study to ensure you have
adequate power. This takes a purely statistical view of the problem; the
results presented here should be taken alonside other considerations
such as logistcal, financial and ethical factors.</p>
<div class="section level2">
<h2 id="consult-sample-size-tables">1. Consult sample size tables<a class="anchor" aria-label="anchor" href="#consult-sample-size-tables"></a>
</h2>
<p>Our aim is to conduct a multi-cluster survey to test the prevalence
of <em>pfhrp2/3</em> deletions against a defined threshold. The question
is; how many clusters should I use and how many samples per cluster?</p>
<p>The fastest way to get an idea of adequate sample size is to consult
pre-computed sample size tables. These are distributed as part of the
DRpower package and can be accessed through the <code>df_ss</code>
object. This data.frame contains sample sizes for a wide range of
parameter combinations, so we will start by filtering down to the
parameters we care about. In our case, we will power the study to detect
a prevalence of 10% deletions in our region, and we will assume an
intra-cluster correlation coefficient of 0.05 based on <a href="articles/historical_analysis.html">historical data</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load tidyverse package for manipulating data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># filter sample size data.frame</span></span>
<span><span class="va">df_ss</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prior_ICC_shape2</span> <span class="op">==</span> <span class="fl">9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ICC</span> <span class="op">==</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prev_thresh</span> <span class="op">==</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html" class="external-link">near</a></span><span class="op">(</span><span class="va">prevalence</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">n_clust</span>, <span class="va">N_opt</span><span class="op">)</span>  <span class="co"># show just these two columns</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 19 × 2</span></span></span>
<span><span class="co">#&gt;    n_clust N_opt</span></span>
<span><span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>       2    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>       3    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>       4    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>       5   496</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>       6   113</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>       7    68</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>       8    51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>       9    37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>      10    30</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>      11    25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>      12    22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>      13    17</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>      14    15</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>      15    14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>      16    13</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>      17    11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span>      18    11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span>      19    10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span>      20     9</span></span></code></pre></div>
<p>Note that <strong>these values are only valid if you intend to
analyse your data using the DRpower model</strong>. If you plan to do a
different statistical analysis then a different power analysis should be
conducted.</p>
<p>We can see that at least 5 clusters are needed, otherwise sample
sizes are too large to be reported in this table. It’s also interesting
to note that the total sample size (<code>n_clust * N_opt</code>)
<em>decreases</em> as we recruit more clusters. For example, a 6-cluster
design would require 678 samples in total, but a 10-cluster design would
need only 300. This is one of <em>many</em> arguments for why it’s a
good idea to recruit as many clusters as possible.</p>
<p>Let’s assume that we can only recruit 6 clusters for logistical
reasons, meaning we would aim for 113 samples per cluster. These
clusters can be chosen through randomisation of all health facilities,
or by using predesignated sentinel surveillance sites. In the latter
case, it is important that sentinel sites are chosen to be
representative of the population in the province as a whole (e.g. in
terms of demographic and social characteristics), otherwise we risk
getting a biased view of <em>pfhrp2/3</em> deletion prevalence.</p>
</div>
<div class="section level2">
<h2 id="consult-power-curves">2. Consult power curves<a class="anchor" aria-label="anchor" href="#consult-power-curves"></a>
</h2>
<p>Although sample size tables are a good starting point, they do not
tell us how power is changing with <span class="math inline">\(N\)</span>. It could be that the curve is very
steep, in which case dropping even just a few samples would really hurt
our power. On the other hand, it could be that it is very shallow, in
which case we have some more wiggle room.</p>
<p>All of the power curves that were used to produce the sample size
table above are distributed with the DRpower package and accessible via
the <code>df_sim</code> object. As before, we need to filter this very
large data.frame to get the curve we are interested in:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filter data</span></span>
<span><span class="va">df_sim_filter</span> <span class="op">&lt;-</span> <span class="va">df_sim</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prior_ICC_shape2</span> <span class="op">==</span> <span class="fl">9</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">n_clust</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ICC</span> <span class="op">==</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">prev_thresh</span> <span class="op">==</span> <span class="fl">0.05</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/near.html" class="external-link">near</a></span><span class="op">(</span><span class="va">prevalence</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot power as a function of N</span></span>
<span><span class="va">df_sim_filter</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">N</span>, y <span class="op">=</span> <span class="va">power_mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.8</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="tutorial_design_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>We find that the power curve is fairly shallow around the chosen
value of N = 113. For example, the value N = 70 still achieves 75%
power. We need to be pragmatic about these numbers, and not stick
dogmatically to the target value of 80% power without thinking about
what it means. We should remember that power is defined as the
probability of finding an interesting result if it is there, so a study
with 75% power has alsmost as good a chance of success as a study with
80% power, i.e. it’s not the case that if we fail to hit 80% then the
study is completely invalid. This is important because a drop in sample
size from 113 per cluster to 70 may be the difference between a study
that is feasible to conduct and one that is not. We need to balance
these factors against each other when coming up with a study design.</p>
<p>That being said, we should not allow power to drop too low or the
study may not be worth doing. In our case we will stick to the target
value of 113 samples per cluster, as we believe we can raise funds to
this level and successfully carry out the project in practice.</p>
</div>
<div class="section level2">
<h2 id="refine-cluster-sizes">3. Refine cluster sizes<a class="anchor" aria-label="anchor" href="#refine-cluster-sizes"></a>
</h2>
<p>Next, we should examine our 6 clusters individually to see if they
are able to recruit 113 samples. Ideally, this should be informed by
historical case reports, which can give a good indication of how many
malaria cases tend to be seen throughout the transmission season.</p>
<p>In our case, let’s assume that two sites are in low transmission
areas, meaning they can only recruit 60 samples during the study
timeframe. Another two sites are very small, and only have the capacity
to enrol 40 samples.</p>
<p>The question is - how much do these smaller clusters hurt our power?
We cannot work this out from sample size tables or power curves because
it is very unlikely that we have results for this exact situation. But
we can explore power directly using the
<code><a href="../reference/get_power_threshold.html">get_power_threshold()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_power_threshold.html">get_power_threshold</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">113</span>, <span class="fl">113</span>, <span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">40</span>, <span class="fl">40</span><span class="op">)</span>,   <span class="co"># new cluster sizes</span></span>
<span>                    prevalence <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                    ICC <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    prev_thresh <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    reps <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt;   power lower upper</span></span>
<span><span class="co">#&gt; 1  73.7 70.85 76.41</span></span></code></pre></div>
<p>We find that power is slightly lower than before, probably around
74%. We could try to balance things out by obtaining more samples from
our remaining two clusters:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_power_threshold.html">get_power_threshold</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">250</span>, <span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">40</span>, <span class="fl">40</span><span class="op">)</span>,   <span class="co"># rebalanced cluster sizes</span></span>
<span>                    prevalence <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                    ICC <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    prev_thresh <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    reps <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt;   power lower upper</span></span>
<span><span class="co">#&gt; 1  77.7 74.99 80.25</span></span></code></pre></div>
<p>This rebalancing has helped, power is now back up to around 78%, but
it comes at the cost of obtaining more samples. The total sample size
has now gone up to 700 from the original 678.</p>
<p>As an aside, compare this with what happens if we were able to
recruit just one more cluster, rather than expanding our existing
clusters:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_power_threshold.html">get_power_threshold</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">113</span>, <span class="fl">113</span>, <span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">40</span>, <span class="fl">40</span>, <span class="fl">40</span><span class="op">)</span>,   <span class="co"># one more cluster of size 40</span></span>
<span>                    prevalence <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                    ICC <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    prev_thresh <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>                    reps <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="co">#&gt;   power lower upper</span></span>
<span><span class="co">#&gt; 1  78.2 75.51 80.72</span></span></code></pre></div>
<p>Power is now recovered to around 78% while the total sample size is
only 466. This emphasises the point that <em>where possible</em> we
should put our efforts into recruiting more clusters rather than
increasing per-cluster sample sizes.</p>
<p>In our case, we assume a hard limit of 6 clusters, so we will stick
with the rebalanced numbers:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># final sample sizes per cluster</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">250</span>, <span class="fl">250</span>, <span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">40</span>, <span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<p>This should give us power of around 78% (somewhere in the range 75%
to 80%), which is a balance between the target power we would like and
what we can realistically achieve given real world constraints.</p>
</div>
<div class="section level2">
<h2 id="account-for-dropout">4. Account for dropout<a class="anchor" aria-label="anchor" href="#account-for-dropout"></a>
</h2>
<p>The numbers above refer to <em>confirmed malaria cases</em> (by some
gold standard that is <em>not</em> HRP2-based RDTs). But when designing
a study we need to know how many <em>suspected</em> malaria cases to
enrol, which may be much higher. Many suspected malaria cases come back
negative due to the symptoms overlapping with many other illnesses.</p>
<p>To calculate the number of suspected cases that we need to enrol, we
should divide our sample sizes through by the expected positive
fraction. For example, if we assume that 40% of suspected cases will
come back positive then we would do the following:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_suspected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">N</span> <span class="op">/</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">N_suspected</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 625 625 150 150 100 100</span></span></code></pre></div>
<p>The <code><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling()</a></code> function round values up to the nearest
whole number. Here, we have assumed the same positive fraction over all
sites, but if you have data from individual sites that can be used then
that is even better. We might also expect the positive fraction to have
a relationship with transmission intensity, so it’s a good idea to
tailor these values where possible.</p>
<p>We also need to account for dropout, meaning samples that - for one
reason or another - do not make it all the way to the final analysis.
Reasons can include people withdrawing consent from the study, RDTs
getting lost, samples getting contaminated or failing the molecular
laboritory methods. It is always a good idea to assume <em>some</em>
level of dropout, and a local technician is often the best person to
give informed advice. In our case we will assume dropout of 10%, meaning
we need to divide through again by 0.9:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">N_suspected</span> <span class="op">/</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">N_final</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 695 695 167 167 112 112</span></span></code></pre></div>
<p>This are the final numbers that we want to enrol. At this stage, it
is worth doing a sanity check with the staff at the local facilities
that they expect to be able to enrol these numbers within the study
period. This is also the point at which we can do full budget
calculations.</p>
</div>
<div class="section level2">
<h2 id="iterate-and-improve">5. Iterate and improve<a class="anchor" aria-label="anchor" href="#iterate-and-improve"></a>
</h2>
<p>Although we have completed a full statistical analysis of the number
of clusters and samples, we should not think of these values as set in
stone. Rather, they give a first sketch of a study design that may be
workable, and that has nice statistical properties. But if this turns
out to be impractical, either from logistical or budgetary perspectives,
then we are free to explore variations in the hope of getting something
that will work. What we should <em>not</em> do is 1) continue doggedly
with a plan that we believe will fail in practice, or 2) throw all
statistical arguments out the window and just collect whatever samples
we can get our hands on. It is normally possible to balance statistical
arguments against real world constraints to get something that satisfies
both.</p>
<p align="center">
<button class="btn btn-primary" onclick="window.location.href='https://mrc-ide.github.io/DRpower/articles/tutorial_analysis.html';">
Next topic
</button>
</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Bob Verity.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
