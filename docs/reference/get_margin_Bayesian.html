<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Margin of error calculations using the Bayesian DRpower model when
  estimating prevalence from a clustered survey — get_margin_Bayesian • DRpower</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Margin of error calculations using the Bayesian DRpower model when
  estimating prevalence from a clustered survey — get_margin_Bayesian"><meta property="og:description" content="As well as comparing against a threshold, the function
  get_prevalence() can be used to estimate a Bayesian credible
  interval (CrI) on the prevalence. This function returns the margin of error
  (MOE) we can expect via this method, in terms of the expected lower and
  upper limits of our credible interval (CrI)."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DRpower</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    How it works
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/rationale1_background.html">Background</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Analysing data</li>
    <li>
      <a href="../articles/rationale2_issue.html">CIs and overdispersion</a>
    </li>
    <li>
      <a href="../articles/rationale3_design_effect.html">The design effect</a>
    </li>
    <li>
      <a href="../articles/rationale4_weaknesses.html">Weaknesses with the traditional approach</a>
    </li>
    <li>
      <a href="../articles/rationale5_bayesian.html">A Bayesian approach</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Designing a study</li>
    <li>
      <a href="../articles/rationale6_master_protocol.html">Sample size calculation in the 2020 master protocol</a>
    </li>
    <li>
      <a href="../articles/rationale7_ztest.html">The one-sample z-test</a>
    </li>
    <li>
      <a href="../articles/rationale8_power.html">Power and sample size in the DRpower model</a>
    </li>
  </ul></li>
<li>
  <a href="../articles/installation.html">Installation</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial_design.html">Designing a study</a>
    </li>
    <li>
      <a href="../articles/tutorial_analysis.html">Analysing data</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/mathematical_details.html">Mathematical details</a>
    </li>
    <li>
      <a href="../articles/historical_analysis.html">Historical analysis</a>
    </li>
    <li>
      <a href="../articles/summarise_prevalence.html">How to summarise the prevalence</a>
    </li>
  </ul></li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/mrc-ide/DRpower/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Margin of error calculations using the Bayesian DRpower model when
  estimating prevalence from a clustered survey</h1>
    <small class="dont-index">Source: <a href="https://github.com/mrc-ide/DRpower/blob/HEAD/R/margins.R" class="external-link"><code>R/margins.R</code></a></small>
    <div class="hidden name"><code>get_margin_Bayesian.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>As well as comparing against a threshold, the function
  <code><a href="get_posterior.html">get_prevalence()</a></code> can be used to estimate a Bayesian credible
  interval (CrI) on the prevalence. This function returns the margin of error
  (MOE) we can expect via this method, in terms of the expected lower and
  upper limits of our credible interval (CrI).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_margin_Bayesian</span><span class="op">(</span></span>
<span>  <span class="va">N</span>,</span>
<span>  prevalence <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  ICC <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  prior_prev_shape1 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  prior_prev_shape2 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  prior_ICC_shape1 <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  prior_ICC_shape2 <span class="op">=</span> <span class="fl">9</span>,</span>
<span>  CrI_type <span class="op">=</span> <span class="st">"HDI"</span>,</span>
<span>  n_intervals <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  round_digits <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  reps <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  use_cpp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  return_full <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>N</dt>
<dd><p>vector of the number of samples obtained from each cluster.</p></dd>


<dt>prevalence</dt>
<dd><p>assumed true prevalence of pfhrp2/3 deletions as a
proportion between 0 and 1.</p></dd>


<dt>ICC</dt>
<dd><p>assumed true intra-cluster correlation (ICC) as a value between 0
and 1.</p></dd>


<dt>alpha</dt>
<dd><p>the significance level of the credible interval - for example,
use <code>alpha = 0.05</code> for a 95% interval. See also <code>CrI_type</code>
argument for how this is calculated.</p></dd>


<dt>prior_prev_shape1, prior_prev_shape2, prior_ICC_shape1, prior_ICC_shape2</dt>
<dd><p>parameters that dictate the shape of the Beta priors on prevalence and the
ICC. See the <a href="https://en.wikipedia.org/wiki/Beta_distribution" class="external-link">Wikipedia page on the Beta
distribution</a> for more detail. The default values of these parameters were chosen
based on an
<a href="https://mrc-ide.github.io/DRpower/articles/historical_analysis.html" class="external-link">analysis
of historical pfhrp2/3 studies</a>, although this does not guarantee that they
will be suitable in all settings.</p></dd>


<dt>CrI_type</dt>
<dd><p>which method to use when computing credible intervals.
Options are "ETI" (equal-tailed interval) or "HDI" (high-density interval).
The ETI searches a distance <code>alpha/2</code> from either side of the [0,1]
interval. The HDI method returns the narrowest interval that subtends a
proportion <code>1-alpha</code> of the distribution. The HDI method is used by
default as it guarantees that the MAP estimate is within the credible
interval, which is not always the case for the ETI.</p></dd>


<dt>n_intervals</dt>
<dd><p>the number of intervals used in the adaptive quadrature
method. Increasing this value gives a more accurate representation of the
true posterior, but comes at the cost of reduced speed.</p></dd>


<dt>round_digits</dt>
<dd><p>the number of digits after the decimal point that are
used when reporting estimates. This is to simplify results and to avoid
giving the false impression of extreme precision.</p></dd>


<dt>reps</dt>
<dd><p>number of times to repeat simulation per parameter combination.</p></dd>


<dt>use_cpp</dt>
<dd><p>if <code>TRUE</code> (the default) then use an Rcpp implementation
of the adaptive quadrature approach that is much faster than the base R
method.</p></dd>


<dt>return_full</dt>
<dd><p>if <code>TRUE</code> then return the complete distribution of
lower and upper CrI limits in a data.frame. If <code>FALSE</code> (the default)
return a summary including the mean and 95% CI of these limits.</p></dd>


<dt>silent</dt>
<dd><p>if <code>TRUE</code> then suppress all console output.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>If <code>return_full = FALSE</code> (the default) returns an estimate of
  the lower and upper CrI limit in the form of a data.frame. The first row
  gives the lower limit, the second row gives the upper limit, both as
  percentages. The first column gives the point estimate, the subsequent
  columns give the 95% CI on this estimate. If <code>return_full = TRUE</code></p>


<p>then returns a complete data.frame of all lower and upper CI realisations
  over simulations.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Estimates MOE using the following approach:</p><ol><li><p>Simulate data via the function <code>rbbinom_reparam()</code> using known
 values, e.g. a known "true" prevalence and intra-cluster correlation.</p></li>
<li><p>Analyse data using <code><a href="get_posterior.html">get_prevalence()</a></code>. Determine the upper and
 lower limits of the credible interval.</p></li>
<li><p>Repeat steps 1-2 <code>reps</code> times to obtain the distribution of upper
 and lower limits. Return the mean of this distribution along with upper and
 lower 95% CIs. To be completely clear, we are producing a 95% CI on the
 limits of a CrI, which can be confusing! See <em>Value</em> for a clear
 explanation of how to interpret the output.</p></li>
</ol><p>Note that we have not implemented a function to return the sample size
needed to achieve a given MOE under the Bayesian model, as this would
require repeated simulation over different values of <code>N</code> which is
computationally costly. The appropriate value can be established manually if
needed by running <code>get_margin_Bayesian()</code> for different sample sizes.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu">get_margin_Bayesian</span><span class="op">(</span>N <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">120</span>, <span class="fl">90</span>, <span class="fl">150</span><span class="op">)</span>, prevalence <span class="op">=</span> <span class="fl">0.15</span>, ICC <span class="op">=</span> <span class="fl">0.01</span> , reps <span class="op">=</span> <span class="fl">1e2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> |==                                                    |  5% ~1 s remaining     |=====                                                 | 10% ~1 s remaining     |========                                              | 15% ~1 s remaining     |==========                                            | 20% ~1 s remaining     |=============                                         | 25% ~1 s remaining     |================                                      | 30% ~1 s remaining     |===================                                   | 35% ~1 s remaining     |=====================                                 | 40% ~1 s remaining     |========================                              | 45% ~1 s remaining     |===========================                           | 51% ~1 s remaining     |==============================                        | 56% ~0 s remaining     |================================                      | 61% ~0 s remaining     |===================================                   | 66% ~0 s remaining     |======================================                | 71% ~0 s remaining     |========================================              | 76% ~0 s remaining     |===========================================           | 81% ~0 s remaining     |==============================================        | 86% ~0 s remaining     |=================================================     | 91% ~0 s remaining     |===================================================   | 96% ~0 s remaining     Completed after 1 s                                                             </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       estimate    CI_2.5   CI_97.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lower   8.1986  7.847912  8.549288</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> upper  29.2766 28.669232 29.883968</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Bob Verity, Shazia Ruybal.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

